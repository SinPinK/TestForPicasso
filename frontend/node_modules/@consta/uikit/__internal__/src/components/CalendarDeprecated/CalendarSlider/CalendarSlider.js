import _defineProperty from"@babel/runtime/helpers/defineProperty";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["currentVisibleDate","className","onChange","value","locale"];import"./CalendarSlider.css";import{IconForward}from"@consta/icons/IconForward";import{addMonths,addYears,endOfYear,format,getMonth,getYear,startOfYear}from"date-fns";import ruLocale from"date-fns/locale/ru";import React,{useEffect,useRef}from"react";import{range}from"../../../utils/array";import{cn}from"../../../utils/bem";import{Button}from"../../Button/Button";import{Text}from"../../Text/Text";export var cnCalendarSlider=cn("CalendarSlider");var isCurrentVisibleYear=function(a,b){return getYear(a)===getYear(b)},isCurrentVisibleMonth=function(a,b){return isCurrentVisibleYear(a,b)&&getMonth(a)===getMonth(b)},getValueRange=function(a,b){if(Array.isArray(b)&&b[0]&&b[1]){var c=startOfYear(a).getTime(),d=endOfYear(a).getTime(),e=b[0].getTime(),f=b[1].getTime();if(!(e>d||f<c)){if(e<=c&&f>=d)return[0,100];var g=d-c,h=function(a){return 100*(a/g)},i=Math.floor(h(e<=c?0:e-c)),j=function(a){if(a>g){return j(a-g)}return a},k=Math.ceil(f>=d?100-i:h(j(f-e)));return[i,k]}}},getMonthsData=function(a,b){return range(12).map(function(c){var d=addMonths(a,c);return{date:d,label:format(d,"MMM",{locale:b})}})},getYearDate=function(a){return new Date(getYear(a),0,1,0,0,0,0)},getSliderData=function(a,b,c){var d=getYearDate(a);return[addYears(d,-1),d,addYears(d,1),addYears(d,2)].map(function(a,d){return{label:format(a,"yyyy",{locale:c}),date:a,months:getMonthsData(a,c),positon:"".concat(d),valueRange:getValueRange(a,b)}})};export var CalendarSlider=function(a){var b=a.currentVisibleDate,c=a.className,d=a.onChange,e=a.value,f=a.locale,g=void 0===f?ruLocale:f,h=_objectWithoutProperties(a,_excluded),i=useRef(null),j=useRef(null);useEffect(function(){i.current&&j.current&&j.current.style.setProperty("--selector-offset","".concat(i.current.offsetLeft,"px"))},[b]);var k=getSliderData(b,e,g);return React.createElement("div",Object.assign({},h,{className:cnCalendarSlider(null,[c])}),React.createElement(Button,{className:cnCalendarSlider("Button",{direction:"prev"}),view:"ghost",type:"button",iconLeft:IconForward,onClick:function handlePrev(){return d(addYears(b,-1))}}),React.createElement("div",{className:cnCalendarSlider("Slider"),ref:j},React.createElement("div",{className:cnCalendarSlider("SliderBody")},React.createElement("div",{className:cnCalendarSlider("Selector")}),k.map(function(a){return React.createElement(Text,{className:cnCalendarSlider("YearLabel",{position:a.positon}),weight:"bold",size:"s",key:a.label,view:isCurrentVisibleYear(b,a.date)?void 0:"ghost"},a.label)}),k.map(function(a){var c;return React.createElement("div",{key:a.label,className:cnCalendarSlider("Year",{position:a.positon,selected:!!a.valueRange}),style:a.valueRange&&(c={},_defineProperty(c,"--value-offset","".concat(a.valueRange[0],"%")),_defineProperty(c,"--value-width","".concat(a.valueRange[1],"%")),c)},a.months.map(function(a,c){return React.createElement("button",{className:cnCalendarSlider("Month"),key:c,onClick:function onClick(){return d(a.date)},onKeyDown:function onKeyDown(){return d(addMonths(a.date,1))},ref:isCurrentVisibleMonth(b,a.date)?i:null,type:"button"},React.createElement(Text,{className:cnCalendarSlider("MonthLabel"),size:"2xs",view:"ghost",align:"center"},a.label))}))}))),React.createElement(Button,{className:cnCalendarSlider("Button",{direction:"next"}),view:"ghost",type:"button",iconLeft:IconForward,onClick:function handleNext(){return d(addYears(b,1))}}))};
//# sourceMappingURL=CalendarSlider.js.map