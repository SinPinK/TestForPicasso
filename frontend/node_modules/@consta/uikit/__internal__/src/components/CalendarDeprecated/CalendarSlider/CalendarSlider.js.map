{"version":3,"file":"CalendarSlider.js","names":["IconForward","addMonths","addYears","endOfYear","format","getMonth","getYear","startOfYear","ruLocale","React","useEffect","useRef","range","cn","Button","Text","cnCalendarSlider","isCurrentVisibleYear","currentDate","month","isCurrentVisibleMonth","getValueRange","yearDate","value","Array","isArray","yearStartDateTime","getTime","yearEndDateTime","valueStartDateTime","valueEndDateTime","msInYear","inProcent","number","offset","Math","floor","minusYears","n","width","ceil","getMonthsData","date","locale","map","monthDate","label","getYearDate","Date","getSliderData","currentYear","index","months","positon","valueRange","CalendarSlider","props","currentVisibleDate","className","onChange","otherProps","currentMonthRef","sliderRef","current","style","setProperty","offsetLeft","data","direction","handlePrev","year","position","selected","handleNext"],"sources":["../../../../../../src/components/CalendarDeprecated/CalendarSlider/CalendarSlider.tsx"],"sourcesContent":["import './CalendarSlider.css';\n\nimport { IconForward } from '@consta/icons/IconForward';\nimport {\n  addMonths,\n  addYears,\n  endOfYear,\n  format,\n  getMonth,\n  getYear,\n  Locale,\n  startOfYear,\n} from 'date-fns';\nimport ruLocale from 'date-fns/locale/ru';\nimport React, { useEffect, useRef } from 'react';\n\nimport { range } from '../../../utils/array';\nimport { cn } from '../../../utils/bem';\nimport { DateRange } from '../../../utils/types/Date';\nimport { PropsWithHTMLAttributes } from '../../../utils/types/PropsWithHTMLAttributes';\nimport { Button } from '../../Button/Button';\nimport { Text } from '../../Text/Text';\n\nexport type CalendarSliderProps = PropsWithHTMLAttributes<\n  {\n    currentVisibleDate: Date;\n    onChange: (date: Date) => void;\n    children?: never;\n    value?: Date | DateRange;\n    locale?: Locale;\n  },\n  HTMLDivElement\n>;\n\nexport const cnCalendarSlider = cn('CalendarSlider');\n\nconst isCurrentVisibleYear = (currentDate: Date, month: Date) =>\n  getYear(currentDate) === getYear(month);\n\nconst isCurrentVisibleMonth = (currentDate: Date, month: Date) =>\n  isCurrentVisibleYear(currentDate, month) &&\n  getMonth(currentDate) === getMonth(month);\n\nconst getValueRange = (yearDate: Date, value?: Date | DateRange) => {\n  if (!Array.isArray(value)) {\n    return undefined;\n  }\n\n  if (!value[0] || !value[1]) {\n    return undefined;\n  }\n\n  const yearStartDateTime = startOfYear(yearDate).getTime();\n  const yearEndDateTime = endOfYear(yearDate).getTime();\n  const valueStartDateTime = value[0].getTime();\n  const valueEndDateTime = value[1].getTime();\n\n  if (\n    valueStartDateTime > yearEndDateTime ||\n    valueEndDateTime < yearStartDateTime\n  ) {\n    return undefined;\n  }\n\n  if (\n    valueStartDateTime <= yearStartDateTime &&\n    valueEndDateTime >= yearEndDateTime\n  ) {\n    return [0, 100];\n  }\n\n  const msInYear = yearEndDateTime - yearStartDateTime;\n  const inProcent = (number: number) => (number / msInYear) * 100;\n  const offset = Math.floor(\n    inProcent(\n      valueStartDateTime <= yearStartDateTime\n        ? 0\n        : valueStartDateTime - yearStartDateTime,\n    ),\n  );\n\n  const minusYears = (n: number): number => {\n    if (n > msInYear) {\n      const newNumber = n - msInYear;\n      return minusYears(newNumber);\n    }\n\n    return n;\n  };\n\n  const width = Math.ceil(\n    valueEndDateTime >= yearEndDateTime\n      ? 100 - offset\n      : inProcent(minusYears(valueEndDateTime - valueStartDateTime)),\n  );\n\n  return [offset, width];\n};\n\nconst getMonthsData = (date: Date, locale: Locale) =>\n  range(12).map((month) => {\n    const monthDate = addMonths(date, month);\n    return {\n      date: monthDate,\n      label: format(monthDate, 'MMM', { locale }),\n    };\n  });\n\nconst getYearDate = (date: Date) => new Date(getYear(date), 0, 1, 0, 0, 0, 0);\n\nconst getSliderData = (\n  date: Date,\n  value: Date | DateRange | undefined,\n  locale: Locale,\n) => {\n  const currentYear = getYearDate(date);\n\n  return [\n    addYears(currentYear, -1),\n    currentYear,\n    addYears(currentYear, 1),\n    addYears(currentYear, 2),\n  ].map((date, index) => ({\n    label: format(date, 'yyyy', { locale }),\n    date,\n    months: getMonthsData(date, locale),\n    positon: `${index}`,\n    valueRange: getValueRange(date, value),\n  }));\n};\n\nexport const CalendarSlider: React.FC<CalendarSliderProps> = (props) => {\n  const {\n    currentVisibleDate,\n    className,\n    onChange,\n    value,\n    locale = ruLocale,\n    ...otherProps\n  } = props;\n\n  const currentMonthRef = useRef<HTMLButtonElement>(null);\n  const sliderRef = useRef<HTMLDivElement>(null);\n\n  const handlePrev = () => onChange(addYears(currentVisibleDate, -1));\n  const handleNext = () => onChange(addYears(currentVisibleDate, 1));\n\n  useEffect(() => {\n    if (currentMonthRef.current && sliderRef.current) {\n      sliderRef.current.style.setProperty(\n        '--selector-offset',\n        `${currentMonthRef.current.offsetLeft}px`,\n      );\n    }\n  }, [currentVisibleDate]);\n\n  const data = getSliderData(currentVisibleDate, value, locale);\n\n  return (\n    <div {...otherProps} className={cnCalendarSlider(null, [className])}>\n      <Button\n        className={cnCalendarSlider('Button', { direction: 'prev' })}\n        view=\"ghost\"\n        type=\"button\"\n        iconLeft={IconForward}\n        onClick={handlePrev}\n      />\n      <div className={cnCalendarSlider('Slider')} ref={sliderRef}>\n        <div className={cnCalendarSlider('SliderBody')}>\n          <div className={cnCalendarSlider('Selector')} />\n          {data.map((year) => (\n            <Text\n              className={cnCalendarSlider('YearLabel', {\n                position: year.positon,\n              })}\n              weight=\"bold\"\n              size=\"s\"\n              key={year.label}\n              view={\n                isCurrentVisibleYear(currentVisibleDate, year.date)\n                  ? undefined\n                  : 'ghost'\n              }\n            >\n              {year.label}\n            </Text>\n          ))}\n          {data.map((year) => (\n            <div\n              key={year.label}\n              className={cnCalendarSlider('Year', {\n                position: year.positon,\n                selected: !!year.valueRange,\n              })}\n              style={\n                year.valueRange && {\n                  ['--value-offset' as string]: `${year.valueRange[0]}%`,\n                  ['--value-width' as string]: `${year.valueRange[1]}%`,\n                }\n              }\n            >\n              {year.months.map((month, index) => (\n                <button\n                  className={cnCalendarSlider('Month')}\n                  key={index}\n                  onClick={() => onChange(month.date)}\n                  onKeyDown={() => onChange(addMonths(month.date, 1))}\n                  ref={\n                    isCurrentVisibleMonth(currentVisibleDate, month.date)\n                      ? currentMonthRef\n                      : null\n                  }\n                  type=\"button\"\n                >\n                  <Text\n                    className={cnCalendarSlider('MonthLabel')}\n                    size=\"2xs\"\n                    view=\"ghost\"\n                    align=\"center\"\n                  >\n                    {month.label}\n                  </Text>\n                </button>\n              ))}\n            </div>\n          ))}\n        </div>\n      </div>\n      <Button\n        className={cnCalendarSlider('Button', { direction: 'next' })}\n        view=\"ghost\"\n        type=\"button\"\n        iconLeft={IconForward}\n        onClick={handleNext}\n      />\n    </div>\n  );\n};\n"],"mappings":"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"}