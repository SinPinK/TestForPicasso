{"version":3,"file":"ContextMenuLevel.js","names":["React","createRef","useEffect","useMemo","useState","cn","getGroups","Popover","ContextMenuDivider","ContextMenuGroupHeader","ContextMenuItem","contextMenuDefaultSize","cnContextMenuLevel","renderHeader","groupLabel","first","length","size","timers","clearTimers","timer","clearTimeout","closeDelay","ContextMenuLevel","forwardRef","props","ref","level","activeItem","addLevel","className","deleteLevel","items","setHoveredParenLevel","getLabel","getRightSideBar","getLeftSideBar","getSubItems","getGroupId","getAccent","getDisabled","getOnClick","getItemOnClick","onItemClick","getItemHTMLAttributes","getItemAs","sortGroup","getGroupLabel","direction","possibleDirections","offset","onSetDirection","hoveredParenLevel","spareDirection","anchorRef","otherProps","hovered","setHovered","groups","a","b","key","getItemIndex","groupId","itemIndex","itemsRefs","constructItemRefs","refs","group","i","setTimeout","firstLevel","map","groupIndex","item","index","disabled","label","leftSide","rightSide","subItems","onMouseEnter","accent","atributes","as","onClick","e"],"sources":["../../../../../../src/components/ContextMenuDeprecated/ContextMenuLevel/ContextMenuLevel.tsx"],"sourcesContent":["import './ContextMenuLevel.css';\n\nimport React, { createRef, useEffect, useMemo, useState } from 'react';\n\nimport { cn } from '../../../utils/bem';\nimport { getGroups } from '../../../utils/getGroups';\nimport { Popover } from '../../Popover/Popover';\nimport { ContextMenuDivider } from '../ContextMenuDivider/ContextMenuDivider';\nimport { ContextMenuGroupHeader } from '../ContextMenuGroupHeader/ContextMenuGroupHeader';\nimport { ContextMenuItem } from '../ContextMenuItem/ContextMenuItem';\nimport {\n  contextMenuDefaultSize,\n  ContextMenuLevelType,\n  ContextMenuPropSize,\n} from '../helpers';\n\nexport const cnContextMenuLevel = cn('ContextMenuLevelDeprecated');\n\nfunction renderHeader(\n  groupLabel: string | number | undefined,\n  first: boolean,\n  length: number,\n  size?: ContextMenuPropSize,\n): React.ReactNode | null {\n  if (!groupLabel) {\n    if (first) {\n      return null;\n    }\n    return <ContextMenuDivider size={size} />;\n  }\n  return (\n    <ContextMenuGroupHeader label={groupLabel} first={first} size={size} />\n  );\n}\n\nlet timers: ReturnType<typeof setTimeout>[] = [];\nexport function clearTimers() {\n  for (const timer of timers) {\n    clearTimeout(timer);\n  }\n  timers = [];\n}\nconst closeDelay = 300;\n\nexport const ContextMenuLevel: ContextMenuLevelType = React.forwardRef(\n  (props, ref: React.Ref<HTMLDivElement>) => {\n    const {\n      // props относящиеся к уровню меню\n      size = contextMenuDefaultSize,\n      level,\n      activeItem,\n      addLevel,\n      className,\n      deleteLevel,\n      items,\n      setHoveredParenLevel,\n\n      // props относящиеся к пунктам меню\n      getLabel,\n      getRightSideBar,\n      getLeftSideBar,\n      getSubItems,\n      getGroupId,\n      getAccent,\n      getDisabled,\n      getOnClick,\n      getItemOnClick,\n      onItemClick,\n      getItemHTMLAttributes,\n      getItemAs,\n\n      // props относящиеся к группам меню\n      sortGroup,\n      getGroupLabel,\n\n      // props относящиеся к поповеру\n      direction,\n      possibleDirections,\n      offset,\n      onSetDirection,\n      hoveredParenLevel,\n      spareDirection,\n      anchorRef,\n      ...otherProps\n    } = props;\n\n    const [hovered, setHovered] = useState<boolean>(false);\n\n    const groups = getGroups(\n      items,\n      getGroupId,\n      undefined,\n      undefined,\n      sortGroup && ((a, b) => sortGroup(a.key, b.key)),\n    );\n\n    const getItemIndex = (groupId: number | string, itemIndex: number) =>\n      `${groupId}-${itemIndex}`;\n\n    const constructItemRefs: () => Record<\n      string,\n      React.RefObject<HTMLDivElement>\n    > = () => {\n      const refs: Record<string, React.RefObject<HTMLDivElement>> = {};\n\n      for (const group of groups) {\n        for (let i = 0; i < items.length; i++) {\n          refs[getItemIndex(group.key, i)] = createRef<HTMLDivElement>();\n        }\n      }\n      return refs;\n    };\n\n    const itemsRefs = useMemo(constructItemRefs, [items]);\n\n    useEffect(() => {\n      if (level !== 0 && !hovered && hoveredParenLevel < level) {\n        clearTimeout(timers[level]);\n        timers[level] = setTimeout(() => deleteLevel(level), closeDelay);\n      }\n      return () => {\n        clearTimeout(timers[level]);\n      };\n    }, [hovered, hoveredParenLevel]);\n\n    return (\n      <Popover\n        {...otherProps}\n        anchorRef={anchorRef}\n        className={cnContextMenuLevel({ firstLevel: level === 0, direction }, [\n          className,\n        ])}\n        possibleDirections={possibleDirections}\n        spareDirection={spareDirection}\n        direction={direction}\n        offset={offset}\n        onSetDirection={onSetDirection}\n        onMouseEnter={() => setHovered(true)}\n        onMouseLeave={() => setHovered(false)}\n        ref={ref}\n      >\n        {groups.map((group, groupIndex) => {\n          const groupLabel =\n            typeof getGroupLabel === 'function'\n              ? getGroupLabel(group.key)\n              : undefined;\n          return (\n            <div className={cnContextMenuLevel('Group')} key={group.key}>\n              {renderHeader(groupLabel, groupIndex === 0, groups.length, size)}\n              {group.items.map((item, index) => {\n                const itemIndex = getItemIndex(group.key, index);\n                const ref = itemsRefs[itemIndex];\n                const disabled =\n                  typeof getDisabled === 'function' ? getDisabled(item) : false;\n                const label = getLabel(item);\n                const leftSide =\n                  typeof getLeftSideBar === 'function'\n                    ? getLeftSideBar(item)\n                    : undefined;\n                const rightSide =\n                  typeof getRightSideBar === 'function'\n                    ? getRightSideBar(item)\n                    : undefined;\n                const subItems =\n                  typeof getSubItems === 'function'\n                    ? getSubItems(item)\n                    : undefined;\n                const onClick = (\n                  e: React.MouseEvent<HTMLDivElement, MouseEvent>,\n                ) => {\n                  if (!disabled) {\n                    if (typeof getItemOnClick === 'function') {\n                      getItemOnClick(item)?.(e);\n                    }\n                    if (typeof getOnClick === 'function') {\n                      getOnClick(item)?.(e);\n                    }\n                    if (typeof onItemClick === 'function') {\n                      onItemClick?.({ e, item });\n                    }\n                  }\n                };\n                const onMouseEnter =\n                  subItems && !disabled\n                    ? () => {\n                        addLevel(level + 1, subItems, ref, itemIndex);\n                        setHoveredParenLevel(level + 1);\n                      }\n                    : () => {\n                        setHoveredParenLevel(level);\n                      };\n                const accent =\n                  typeof getAccent === 'function' ? getAccent(item) : undefined;\n                const atributes =\n                  typeof getItemHTMLAttributes === 'function'\n                    ? getItemHTMLAttributes(item)\n                    : {};\n                const as =\n                  typeof getItemAs === 'function' ? getItemAs(item) : undefined;\n\n                return (\n                  <ContextMenuItem\n                    {...atributes}\n                    ref={ref}\n                    label={label}\n                    leftSide={leftSide}\n                    rightSide={rightSide}\n                    size={size}\n                    key={itemIndex}\n                    onMouseEnter={onMouseEnter}\n                    onClick={onClick}\n                    active={activeItem === itemIndex}\n                    withSubMenu={Boolean(subItems)}\n                    accent={accent}\n                    disabled={disabled}\n                    as={as}\n                  />\n                );\n              })}\n            </div>\n          );\n        })}\n      </Popover>\n    );\n  },\n);\n"],"mappings":"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"}