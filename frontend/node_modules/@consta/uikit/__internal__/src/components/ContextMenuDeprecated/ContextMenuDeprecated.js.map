{"version":3,"file":"ContextMenuDeprecated.js","names":["React","createRef","forwardRef","useEffect","useMemo","useState","useClickOutside","useForkRef","directions","clearTimers","ContextMenuLevel","contextMenuPropDefaultSubMenuDirection","contextMenuPropSubMenuDirections","ContextMenu","props","ref","items","anchorRef","position","direction","possibleDirections","offset","getKeyProp","getKey","getSubItems","subMenuDirection","propSubMenuDirection","getLabel","onClickOutside","spareDirection","style","otherProps","levels","setLevels","setSubMenuDirection","hoveredParenLevel","setHoveredParenLevel","addLevel","level","activeItem","oldDirection","newLevels","Array","from","length","splice","push","deleteLevel","levelsRefs","constructItemRefs","refs","i","firstLevelRef","isActive","ignoreClicksInsideRefs","current","handler","e","find","key","item","subItems","subItem","map","index","onSetDirection","zIndex"],"sources":["../../../../../src/components/ContextMenuDeprecated/ContextMenuDeprecated.tsx"],"sourcesContent":["import React, {\n  createRef,\n  forwardRef,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { useClickOutside } from '../../hooks/useClickOutside/useClickOutside';\nimport { useForkRef } from '../../hooks/useForkRef/useForkRef';\nimport { Direction, directions } from '../Popover/Popover';\nimport {\n  clearTimers,\n  ContextMenuLevel,\n} from './ContextMenuLevel/ContextMenuLevel';\nimport {\n  AddLevel,\n  ContextMenuComponent,\n  contextMenuPropDefaultSubMenuDirection,\n  contextMenuPropSubMenuDirections,\n  DeleteLevel,\n  Level,\n} from './helpers';\n\nexport const ContextMenu: ContextMenuComponent = forwardRef((props, ref) => {\n  const {\n    items,\n    anchorRef,\n    position,\n    direction,\n    possibleDirections = directions,\n    offset,\n    getKey: getKeyProp,\n    getSubItems,\n    subMenuDirection:\n      propSubMenuDirection = contextMenuPropDefaultSubMenuDirection,\n    getLabel,\n    onClickOutside,\n    spareDirection,\n    style,\n    ...otherProps\n  } = props;\n\n  type Item = typeof items[number];\n\n  const getKey = getKeyProp || getLabel;\n\n  const defaultLevels = [\n    {\n      items,\n      anchorRef,\n      position,\n      direction,\n      possibleDirections,\n      offset,\n    },\n  ] as Level<Item>[];\n\n  const [levels, setLevels] = useState<Level<Item>[]>(defaultLevels);\n  const [subMenuDirection, setSubMenuDirection] =\n    useState<Direction>(propSubMenuDirection);\n  const [hoveredParenLevel, setHoveredParenLevel] = useState<number>(-1);\n\n  const addLevel: AddLevel<Item> = (level, items, anchorRef, activeItem) => {\n    const newLevels = Array.from(levels);\n\n    let oldDirection: Direction | undefined;\n\n    if (newLevels[level] && newLevels.length - level > 1) {\n      oldDirection = newLevels[level].direction;\n\n      if (oldDirection) {\n        setSubMenuDirection(oldDirection);\n      }\n    }\n\n    newLevels[level - 1].activeItem = activeItem;\n    newLevels.splice(level);\n    newLevels.push({\n      items,\n      anchorRef,\n      direction: oldDirection || subMenuDirection,\n      possibleDirections: contextMenuPropSubMenuDirections,\n    });\n    setLevels(newLevels);\n  };\n\n  const deleteLevel: DeleteLevel = (level) => {\n    const newLevels = Array.from(levels);\n    newLevels.splice(level);\n    newLevels[level - 1] = { ...newLevels[level - 1], activeItem: undefined };\n    setLevels(newLevels);\n  };\n\n  const constructItemRefs: () => React.RefObject<HTMLDivElement>[] = () => {\n    const refs: React.RefObject<HTMLDivElement>[] = [];\n\n    for (let i = 0; i < levels.length; i++) {\n      refs[i] = createRef<HTMLDivElement>();\n    }\n\n    return refs;\n  };\n\n  const levelsRefs = useMemo(constructItemRefs, [levels]);\n\n  const firstLevelRef = useForkRef([levelsRefs[0], ref]);\n\n  useClickOutside({\n    isActive: !!onClickOutside,\n    ignoreClicksInsideRefs: [...levelsRefs, anchorRef || { current: null }],\n    handler: (e) => onClickOutside && onClickOutside(e),\n  });\n\n  useEffect(() => {\n    // из-за отложенного рендера закрытия подпунктов меню\n    // может возникнуть ситуация когда таймер еще не успел отработать и вызвать рендер на закрытие меню,\n    // и если в этот изменяется props.items в компоненте, то сразу после рендера который вызван сменой props.items\n    // вызовется отложенный что приведет к неверному рендеру, который должен был вызваться до изменения props.items\n    // По этому останавливаем отложенный перерендр закрытия, чтобы избежать ошибки\n    clearTimers();\n    // пересобираем levels при изменении пропсов\n    function find(items: Item[], key: string | number): Item | undefined {\n      for (const item of items) {\n        if (getKey(item) === key) {\n          return item;\n        }\n        const subItems = typeof getSubItems === 'function' && getSubItems(item);\n        if (subItems) {\n          const subItem = find(subItems, key);\n          if (subItem) {\n            return subItem;\n          }\n        }\n      }\n      return undefined;\n    }\n\n    const newLevels = levels.map((level) => {\n      return {\n        ...level,\n        items: level.items.map((item) => find(props.items, getKey(item))),\n      };\n    });\n\n    // привел к типа м так как TS не понимает что по ключу всегда найдется нужный нам item\n    setLevels(newLevels as Level<Item>[]);\n    return () => clearTimers();\n  }, [props.items, getSubItems, getKey]);\n\n  return (\n    <>\n      {levels.map((level, index) => {\n        const onSetDirection =\n          index > 0 ? setSubMenuDirection : props.onSetDirection;\n\n        return (\n          <ContextMenuLevel\n            {...otherProps}\n            style={{\n              ...style,\n              ...(typeof style?.zIndex === 'number' && {\n                zIndex: style.zIndex + index,\n              }),\n            }}\n            offset={level.offset}\n            key={index}\n            items={level.items}\n            level={index}\n            addLevel={addLevel}\n            deleteLevel={deleteLevel}\n            anchorRef={level.anchorRef}\n            position={level.position}\n            activeItem={level.activeItem}\n            direction={level.direction}\n            possibleDirections={level.possibleDirections}\n            onSetDirection={onSetDirection}\n            hoveredParenLevel={hoveredParenLevel}\n            setHoveredParenLevel={setHoveredParenLevel}\n            getSubItems={getSubItems}\n            getLabel={getLabel}\n            ref={index === 0 ? firstLevelRef : levelsRefs[index]}\n            spareDirection={index === 0 ? spareDirection : 'rightStartUp'}\n          />\n        );\n      })}\n    </>\n  );\n});\n"],"mappings":"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"}