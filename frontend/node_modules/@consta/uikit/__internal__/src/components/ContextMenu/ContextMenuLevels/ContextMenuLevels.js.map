{"version":3,"file":"ContextMenuLevels.js","names":["React","Fragment","useEffect","useState","Transition","TransitionGroup","useClickOutside","useForkRef","useMutableRef","useRefs","animateTimeout","clearTimers","ContextMenuLevel","getLevels","withDefaultGetters","contextMenuPropDefaultSubMenuDirection","contextMenuPropSubMenuDirections","useSize","ContextMenuLevelsRender","propsComponent","ref","props","items","anchorRef","position","direction","possibleDirections","offset","onClickOutside","getItemKey","getItemLabel","getItemSubMenu","style","spareDirection","subMenuDirection","subMenuDirectionProp","isMobile","isOpen","setComponentSize","enableAnimationBack","disableAnimationBack","otherProps","isOpenRef","defaultLevels","levels","setLevels","setSubMenuDirection","hoveredParenLevel","setHoveredParenLevel","levelsRefs","length","addLevel","level","activeItem","parent","newLevels","oldDirection","splice","push","current","deleteLevel","isActive","ignoreClicksInsideRefs","handler","e","firstLevelRef","map","index","key","last","animate","zIndex","onSetDirection","ContextMenuLevels","forwardRef"],"sources":["../../../../../../src/components/ContextMenu/ContextMenuLevels/ContextMenuLevels.tsx"],"sourcesContent":["import React, { Fragment, useEffect, useState } from 'react';\nimport { Transition, TransitionGroup } from 'react-transition-group';\n\nimport { Direction } from '##/components/Popover';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { animateTimeout } from '##/mixs/MixPopoverAnimate';\n\nimport { clearTimers, ContextMenuLevel } from '../ContextMenuLevel';\nimport { getLevels, withDefaultGetters } from '../helpers';\nimport {\n  AddLevel,\n  ContextMenuItemDefault,\n  ContextMenuLevelsComponent,\n  ContextMenuLevelsProps,\n  contextMenuPropDefaultSubMenuDirection,\n  contextMenuPropSubMenuDirections,\n  Level,\n} from '../types';\nimport { useSize } from './useSize';\n\nconst ContextMenuLevelsRender = (\n  propsComponent: ContextMenuLevelsProps,\n  ref: React.Ref<HTMLDivElement>,\n) => {\n  const props = withDefaultGetters(propsComponent);\n  const {\n    items,\n    anchorRef,\n    position,\n    direction,\n    possibleDirections,\n    offset,\n    onClickOutside,\n    getItemKey,\n    getItemLabel,\n    getItemSubMenu,\n    style,\n    spareDirection,\n    subMenuDirection:\n      subMenuDirectionProp = contextMenuPropDefaultSubMenuDirection,\n    isMobile,\n    isOpen,\n    setComponentSize,\n    enableAnimationBack,\n    disableAnimationBack,\n    ...otherProps\n  } = props;\n\n  const isOpenRef = useMutableRef(isOpen);\n\n  type Item = typeof items[number];\n\n  const defaultLevels: Level<ContextMenuItemDefault>[] = [\n    {\n      items,\n      anchorRef,\n      position,\n      direction,\n      possibleDirections,\n      offset,\n    },\n  ];\n\n  const [levels, setLevels] = useState<\n    Level<ContextMenuItemDefault & { isParent?: boolean }>[]\n  >(isMobile ? defaultLevels : []);\n  const [subMenuDirection, setSubMenuDirection] =\n    useState<Direction>(subMenuDirectionProp);\n  const [hoveredParenLevel, setHoveredParenLevel] = useState<number>(-1);\n\n  const levelsRefs = useRefs<HTMLDivElement>(levels.length);\n\n  const addLevel: AddLevel<Item> = ({\n    level,\n    items,\n    anchorRef,\n    activeItem,\n    parent,\n  }) => {\n    const newLevels: Level<ContextMenuItemDefault & { isParent?: boolean }>[] =\n      [...levels];\n    const oldDirection =\n      newLevels[level] && newLevels.length - level > 1\n        ? newLevels[level].direction\n        : undefined;\n\n    if (newLevels[level] && newLevels.length - level > 1 && oldDirection) {\n      setSubMenuDirection(oldDirection);\n    }\n\n    newLevels[level - 1].activeItem = activeItem;\n    newLevels.splice(level);\n    newLevels.push({\n      items,\n      anchorRef: isMobile ? props.anchorRef : anchorRef,\n      direction: isMobile ? props.direction : oldDirection || subMenuDirection,\n      possibleDirections: isMobile\n        ? props.possibleDirections\n        : contextMenuPropSubMenuDirections,\n      position: isMobile ? props.position : undefined,\n      offset: isMobile ? props.offset : undefined,\n      parent,\n    });\n\n    isOpenRef.current ? setLevels(newLevels) : setLevels([]);\n  };\n\n  const deleteLevel = (level: number) => {\n    enableAnimationBack();\n    const newLevels = [...levels];\n    newLevels.splice(level);\n    newLevels[level - 1] = { ...newLevels[level - 1], activeItem: undefined };\n    setLevels(newLevels);\n    disableAnimationBack();\n  };\n\n  useClickOutside({\n    isActive: !!onClickOutside,\n    ignoreClicksInsideRefs: [...levelsRefs, anchorRef || { current: null }],\n    handler: (e) => onClickOutside?.(e),\n  });\n\n  useEffect(() => {\n    clearTimers();\n    setLevels(\n      getLevels({\n        levels,\n        items,\n        getItemKey,\n        getItemSubMenu,\n      }),\n    );\n    return () => clearTimers();\n  }, [items]);\n\n  const firstLevelRef = useForkRef([levelsRefs[0], ref]);\n\n  useEffect(() => {\n    setLevels(defaultLevels);\n  }, [position]);\n\n  useEffect(() => {\n    setLevels(isOpen ? defaultLevels : []);\n  }, [isOpen]);\n\n  useSize(levelsRefs, setComponentSize, isMobile);\n\n  return (\n    <TransitionGroup component={Fragment}>\n      {levels.map((level, index) => {\n        const key = `${index}-${level.parent ? getItemKey(level.parent) : ''}`;\n\n        const last = index !== levels.length - 1;\n\n        if (isMobile && last) {\n          return <Fragment key={index} />;\n        }\n\n        return (\n          <Transition\n            key={key}\n            timeout={animateTimeout}\n            nodeRef={levelsRefs[index]}\n          >\n            {(animate) => (\n              <ContextMenuLevel\n                {...otherProps}\n                {...level}\n                key={`${index}-${level.parent ? getItemKey(level.parent) : ''}`}\n                isMobile={isMobile}\n                isOpen={isOpen}\n                style={{\n                  ...style,\n                  ...{\n                    zIndex:\n                      typeof style?.zIndex === 'number'\n                        ? style.zIndex + 1\n                        : undefined,\n                  },\n                }}\n                levelDepth={index}\n                getItemLabel={getItemLabel}\n                addLevel={addLevel}\n                deleteLevel={deleteLevel}\n                onSetDirection={\n                  index > 0 ? setSubMenuDirection : props.onSetDirection\n                }\n                hoveredParenLevel={hoveredParenLevel}\n                setHoveredParenLevel={setHoveredParenLevel}\n                getItemSubMenu={getItemSubMenu}\n                getItemKey={getItemKey}\n                ref={index === 0 ? firstLevelRef : levelsRefs[index]}\n                spareDirection={index === 0 ? spareDirection : 'rightStartUp'}\n                parent={isMobile ? level.parent : undefined}\n                animate={animate}\n              />\n            )}\n          </Transition>\n        );\n      })}\n    </TransitionGroup>\n  );\n};\n\nexport const ContextMenuLevels = React.forwardRef(\n  ContextMenuLevelsRender,\n) as ContextMenuLevelsComponent;\n"],"mappings":"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"}