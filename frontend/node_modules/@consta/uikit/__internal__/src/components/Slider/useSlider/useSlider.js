import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import{useCallback,useEffect,useMemo,useRef,useState}from"react";import{useComponentSize}from"../../../hooks/useComponentSize/useComponentSize";import{useMutableRef}from"../../../hooks/useMutableRef/useMutableRef";import{getActiveValue,getNewValue,getValidValue,getValueByPosition,isNotRangeParams,isRangeParams,trackPosition}from"./helper";export var COUNT_STEPS=250;export function useSlider(a){var b=a.disabled,c=a.range,d=a.value,f=a.min,g=a.max,h=a.step,i=void 0===h?1:h,j=a.onChange,k=a.onAfterChange,l=a.sliderRef,m=a.buttonRefs,n=g>f?f:0,o=g>f?g:100,p=useMemo(function(){if(!Array.isArray(i)&&1<=i){var a=Math.abs((o-n)/COUNT_STEPS);return a>i?a-a%i:Math.max(a,i)}return i},[g,f,i]),q=useState(d),r=_slicedToArray(q,2),s=r[0],t=r[1],u=useState(null),v=_slicedToArray(u,2),w=v[0],y=v[1],z=useState(null),A=_slicedToArray(z,2),B=A[0],C=A[1],D=useRef(null),E=useComponentSize(l),F=useMutableRef(s);useEffect(function(){b&&G("remove")},[b]);var G=function(a){var b="add"===a?"addEventListener":"removeEventListener";document[b]("mouseup",L),document[b]("touchend",L),document[b]("mousemove",K),document[b]("touchmove",K)};useEffect(function(){Array.isArray(s)?(I(s[0],0),I(s[1],1)):I(s,0)},[s]),useEffect(function(){JSON.stringify(d)!==JSON.stringify(s)&&(t(d),I(getActiveValue(d,D.current),0),D.current=null)},[d]),useEffect(function(){null===j||void 0===j?void 0:j({value:Array.isArray(s)?[getNewValue(s[0],s[0],i,f,g,0),getNewValue(s[1],s[1],i,f,g,1)]:getNewValue(s,s,i,f,g,0)})},[i]),useEffect(function(){if("undefined"!=typeof d){var b=isRangeParams(a)?[getValidValue(a.value[0],f,g,i),getValidValue(a.value[1],f,g,i)]:getValidValue(a.value,f,g,i);t(b)}},[c,typeof d]),useEffect(function(){if(isRangeParams(a)&&a.value[0]>a.value[1]){var b,c=[a.value[1],a.value[1]];null===(b=a.onChange)||void 0===b?void 0:b.call(a,{value:c})}},[]);var H=useCallback(function(a,c){if(!b&&"number"==typeof c&&"undefined"!=typeof s){var d=Array.isArray(i)?1:i||1,e=!1,h=getActiveValue(s,c);switch(a.key){case"ArrowUp":case"ArrowRight":case"+":e=!0;break;case"ArrowLeft":case"ArrowDown":case"-":e=!0,d*=-1;break;default:}if(e){Array.isArray(i)&&i.forEach(function(a,b){"number"==typeof c&&h===a&&(0<=d?0===b?d=i[1]-n:d=("undefined"==typeof i[b+1]?o:i[b+1])-a:0===b?d=n-i[1]:d=("undefined"==typeof i[b-1]?n:i[b-1])-a)});var k=getNewValue(h+d,s,i,f,g,c);t(k),I(getActiveValue(k,c),c),null===j||void 0===j?void 0:j({e:a,value:k})}}},[s,i,f,g]),I=function(a,b){if(l.current&&"number"==typeof b){var c=m[b].current||l.current,d=l.current.getBoundingClientRect(),e=d.x,f=d.width,g={y:c.offsetTop+c.offsetHeight+50,x:e+Math.abs((a-n)/(o-n))*f};0===b?y(g):C(g)}},J=function(a){if("number"!=typeof D.current)return d;var b=trackPosition(a),c=getValueByPosition(b,l,n,o,i);return getNewValue(c,s,p,f,g,D.current)},K=function(a,b){var c=b||D.current;if("number"==typeof c){var d=J(a),e=getActiveValue(s,c),f=getActiveValue(d,c);t(d),e!==f&&(null===k||void 0===k?void 0:k({e:a,value:d}))}};useEffect(function(){if(isRangeParams(a)){var b;null===(b=a.value)||void 0===b?void 0:b.forEach(function(a,b){I(getActiveValue(a,D.current),0===b?0:1)})}isNotRangeParams(a)&&I(getActiveValue(d,D.current),0),D.current=null},[E,typeof d]);var L=useCallback(function(b){if(G("remove"),isRangeParams(a)&&Array.isArray(F.current)){var c,d=_toConsumableArray(F.current).sort(function(c,a){return+c-+a});null===(c=a.onChange)||void 0===c?void 0:c.call(a,{e:b,value:d})}if(isNotRangeParams(a)&&"number"==typeof F.current){var e;null===(e=a.onChange)||void 0===e?void 0:e.call(a,{e:b,value:F.current})}D.current=null},[F,d,j,K]),M=useCallback(function(a){b||(D.current=a,G("add"))},[s,d,j,K,b]);return{onKeyPress:H,onFocus:function onFocus(a,b){D.current=b},handlePress:M,onSliderClick:function onSliderClick(b){if(isNotRangeParams(a)){var c=getValueByPosition({x:b.pageX,y:b.pageY},l,n,o,i),e=getNewValue(c,s,p,f,g,D.current);e!==d&&(t(e),I(getActiveValue(e,0),0),null===j||void 0===j?void 0:j({e:b,value:e}))}},activeButton:D.current,popoverPosition:[w,B],currentValue:Array.isArray(s)?s:[s]}}
//# sourceMappingURL=useSlider.js.map