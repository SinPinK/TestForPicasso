{"version":3,"file":"useAutoComplete.js","names":["useCallback","useEffect","useMemo","useRef","useState","useClickOutside","useFlag","useKeys","getGroups","useAutoComplete","params","items","dropdownRef","controlRef","disabled","getItemLabel","getItemKey","searchFunction","getItemGroupKey","groups","getGroupKey","onFocus","onBlur","searchValue","inputRef","isOpen","setIsOpen","highlightedIndex","setHighlightedIndex","searchFunctionDefault","item","toLocaleLowerCase","indexOf","filteredOptions","trim","fiteredOptions","filter","visibleItems","resultGroups","length","hasItems","find","group","highlightIndex","indexForHighlight","Math","min","max","onChange","e","value","ArrowUp","_","preventDefault","old","ArrowDown","getKeyProps","PageUp","PageDown","Home","End","Enter","getItem","index","couter","Escape","off","Tab","isActive","ignoreClicksInsideRefs","handler","current","blur","getOptionProps","key","onClick","onMouseEnter","active","hovered","handleInputFocus","on","handleInputBlur","focus"],"sources":["../../../../../src/components/AutoCompleteCanary/useAutoComplete.ts"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useFlag } from '##/hooks/useFlag';\nimport { KeyHandler, useKeys } from '##/hooks/useKeys';\nimport { getGroups } from '##/utils/getGroups';\n\ntype IndexForHighlight = number | ((oldIndex: number) => number);\n\ntype GetItemGroupKey<ITEM> = (item: ITEM) => string | number | undefined;\ntype GetGroupKey<GROUP> = (item: GROUP) => string | number | undefined;\n\ntype OnChangeProp<ITEM> = (props: {\n  value: ITEM | null;\n  e: React.SyntheticEvent;\n}) => void;\n\ntype UseAutoCompleteProps<ITEM, GROUP> = {\n  getItemGroupKey?: GetItemGroupKey<ITEM> | undefined;\n  getGroupKey?: GetGroupKey<GROUP>;\n  groups?: GROUP[];\n  items: ITEM[];\n  dropdownRef: React.MutableRefObject<HTMLDivElement | null>;\n  controlRef: React.MutableRefObject<HTMLDivElement | null>;\n  disabled?: boolean;\n  getItemLabel: (item: ITEM) => string;\n  getItemKey: (item: ITEM) => string | number;\n  searchFunction?: (item: ITEM, searchValue: string) => boolean;\n  onFocus?: React.FocusEventHandler<HTMLInputElement>;\n  onBlur?: React.FocusEventHandler<HTMLInputElement>;\n  searchValue?: string;\n  onChange: OnChangeProp<ITEM>;\n};\n\ntype OptionProps<ITEM> = {\n  index: number;\n  item: ITEM;\n};\n\ntype GetOptionPropsResult = {\n  onClick: (e: React.SyntheticEvent) => void;\n  onMouseEnter: (e: React.SyntheticEvent) => void;\n  active: boolean;\n  hovered: boolean;\n  key: string | number;\n};\n\nexport function useAutoComplete<ITEM, GROUP>(\n  params: UseAutoCompleteProps<ITEM, GROUP>,\n) {\n  const {\n    items,\n    dropdownRef,\n    controlRef,\n    disabled = false,\n    getItemLabel,\n    getItemKey,\n    searchFunction,\n    getItemGroupKey,\n    groups,\n    getGroupKey,\n    onFocus,\n    onBlur,\n    searchValue,\n  } = params;\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [isOpen, setIsOpen] = useFlag();\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\n\n  const searchFunctionDefault = (item: ITEM, searchValue: string) =>\n    getItemLabel(item)\n      .toLocaleLowerCase()\n      .indexOf(searchValue.toLocaleLowerCase()) !== -1;\n\n  const filteredOptions = useMemo(() => {\n    if (searchValue && searchValue.trim() !== '') {\n      const fiteredOptions = items.filter((item) =>\n        searchFunction\n          ? searchFunction(item, searchValue)\n          : searchFunctionDefault(item, searchValue),\n      );\n\n      return fiteredOptions;\n    }\n    return items;\n  }, [items, searchValue]);\n\n  const visibleItems = useMemo(() => {\n    const resultGroups = getGroups(\n      filteredOptions,\n      groups?.length ? getItemGroupKey : undefined,\n      groups,\n      getGroupKey,\n      undefined,\n    );\n\n    return resultGroups;\n  }, [filteredOptions, groups, getItemGroupKey, getGroupKey]);\n\n  const hasItems = useMemo(() => {\n    return !!visibleItems.find((group) => group.items.length > 0);\n  }, [visibleItems]);\n\n  const highlightIndex = useCallback(\n    (indexForHighlight: IndexForHighlight) => {\n      setHighlightedIndex(\n        Math.min(\n          Math.max(\n            0,\n            typeof indexForHighlight === 'function'\n              ? indexForHighlight(highlightedIndex)\n              : indexForHighlight,\n          ),\n          filteredOptions.length - 1,\n        ),\n      );\n    },\n    [filteredOptions, highlightedIndex],\n  );\n\n  const onChange = (e: React.SyntheticEvent, item: ITEM) => {\n    if (!disabled) {\n      params.onChange({ value: item, e });\n    }\n  };\n\n  // Prop Getters\n\n  const ArrowUp: KeyHandler = (_, e): void => {\n    e.preventDefault();\n    highlightIndex((old) => old - 1);\n  };\n\n  const ArrowDown: KeyHandler = (_, e): void => {\n    e.preventDefault();\n    highlightIndex((old) => old + 1);\n  };\n\n  const Enter: KeyHandler = (_, e): void => {\n    if (isOpen) {\n      if (searchValue || filteredOptions[highlightedIndex]) {\n        e.preventDefault();\n      }\n\n      const getItem = (index: number) => {\n        let couter = 0;\n        for (const group of visibleItems) {\n          if (group.items.length + couter > index) {\n            return group.items[index - couter];\n          }\n          couter += group.items.length;\n        }\n        return undefined;\n      };\n\n      const item = getItem(highlightedIndex);\n\n      if (item) {\n        onChange(e, item);\n      }\n    }\n  };\n\n  const Escape = (): void => {\n    setIsOpen.off();\n  };\n\n  const Tab = (): void => {\n    setIsOpen.off();\n  };\n\n  const getKeyProps = useKeys({\n    ArrowUp,\n    ArrowDown,\n    PageUp: ArrowUp,\n    PageDown: ArrowDown,\n    Home: ArrowUp,\n    End: ArrowDown,\n    Enter,\n    Escape,\n    Tab,\n  });\n\n  const getOptionProps = ({\n    index,\n    item,\n  }: OptionProps<ITEM>): GetOptionPropsResult => {\n    const key = getItemKey(item);\n    return {\n      onClick: (e: React.SyntheticEvent) => {\n        onChange(e, item);\n      },\n      onMouseEnter: () => {\n        highlightIndex(index);\n      },\n      active: false,\n      hovered: index === highlightedIndex,\n      key,\n    };\n  };\n\n  useClickOutside({\n    isActive: isOpen,\n    ignoreClicksInsideRefs: [dropdownRef, controlRef],\n    handler: () => {\n      setIsOpen.off();\n    },\n  });\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen.off();\n      inputRef.current?.blur();\n    }\n  }, [disabled]);\n\n  const handleInputFocus = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (!disabled) {\n      if (!isOpen) {\n        setIsOpen.on();\n      }\n      if (typeof onFocus === 'function') {\n        onFocus(e);\n      }\n    }\n  };\n\n  const handleInputBlur = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (isOpen) {\n      inputRef.current?.focus();\n      return;\n    }\n\n    if (typeof onBlur === 'function') {\n      onBlur(e);\n    }\n  };\n\n  return {\n    isOpen: !!(isOpen && hasItems && searchValue && searchValue?.trim() !== ''),\n    visibleItems,\n    getOptionProps,\n    handleInputFocus,\n    handleInputBlur,\n    inputRef,\n    getKeyProps,\n    hasItems,\n  };\n}\n"],"mappings":"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"}