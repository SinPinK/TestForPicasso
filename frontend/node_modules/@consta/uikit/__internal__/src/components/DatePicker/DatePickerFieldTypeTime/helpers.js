import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import{addHours,addMinutes,addSeconds,format as _format,isValid,isWithinInterval,parse as _parse,startOfDay,startOfHour,startOfMinute}from"date-fns";import IMask from"imask";import{useCallback,useEffect,useMemo,useState}from"react";import{useIMask}from"../../TextField";import{useMutableRef}from"../../../hooks/useMutableRef/useMutableRef";import{getLabelHours,getLabelMinutes,getLabelSeconds}from"../../DateTime/helpers";import{datePickerPropFormatTypeTime,getParts,getPartsDate,getTimeEnum}from"../helpers";import{datePickerErrorTypes}from"../types";export var usePicker=function(a){var b=a.value,c=a.onChange,d=a.onError,e=a.multiplicityHours,f=a.multiplicityMinutes,g=a.multiplicitySeconds,h=a.format,i=a.separator,j=a.maxDate,k=a.minDate,l=useMutableRef(c),m=useMutableRef(b),n=useMutableRef(d),o=useState(b&&isValid(b)?_format(b,h):null),p=_slicedToArray(o,2),q=p[0],r=p[1],s=useMutableRef(q),t=useMemo(function(){return getParts(h,":")},[h,i]),u=useCallback(function(a){var b=a.e,c=a.value;if(s.current!==c){r(c);var d=l.current,e=m.current;if(d){if(!c)return void(e&&d({e:b,value:null}));var f=getPartsDate(c,h,":",!1,["HH","mm","ss"]),g=_slicedToArray(f,3),i=g[0],o=g[1],p=g[2];if(f.filter(function(a){return!!a}).length===t.length){var u=_parse("".concat(i,":").concat(o,":").concat(p),datePickerPropFormatTypeTime,e||new Date);if(!isWithinInterval(u,{start:k,end:j})){var q;return null===(q=n.current)||void 0===q?void 0:q.call(n,{type:datePickerErrorTypes[0],stringValue:c,date:u,HH:i,mm:o,ss:p}),void(e&&d({e:b,value:null}))}d({e:b,value:u})}else e&&d({e:b,value:null})}}},[null===k||void 0===k?void 0:k.getTime(),null===j||void 0===j?void 0:j.getTime(),h,i]),v=useMemo(function(){return{mask:Date,pattern:h,blocks:{HH:e&&1<e?{mask:IMask.MaskedEnum,enum:getTimeEnum(24,e,startOfDay,addHours,getLabelHours)}:{mask:IMask.MaskedRange,from:0,to:23},mm:f&&1<f?{mask:IMask.MaskedEnum,enum:getTimeEnum(60,f,startOfHour,addMinutes,getLabelMinutes)}:{mask:IMask.MaskedRange,from:0,to:59},ss:g&&1<g?{mask:IMask.MaskedEnum,enum:getTimeEnum(60,g,startOfMinute,addSeconds,getLabelSeconds)}:{mask:IMask.MaskedRange,from:0,to:59}},lazy:!0,autofix:!0,format:function format(a){return _format(a,h)},parse:function parse(a){return _parse(a,h,new Date)},validate:function validate(a){var b=getPartsDate(a,h,":",!1,["HH","mm","ss"]),c=_slicedToArray(b,3),d=c[0],e=c[1],f=c[2];if(d&&e&&f&&!isValid(_parse("".concat(d,":").concat(e,":").concat(f),datePickerPropFormatTypeTime,new Date))){var g;return null===(g=n.current)||void 0===g?void 0:g.call(n,{type:datePickerErrorTypes[1],stringValue:a,HH:d,mm:e,ss:f}),!1}return!0}}},[h,i,e,f,g]),w=useIMask({value:q,onChange:function(a,b){return null===u||void 0===u?void 0:u(b)},maskOptions:v}),x=w.inputRef;return useEffect(function(){b&&isValid(b)?r(_format(b,h)):(null===q||void 0===q?void 0:q.length)===h.length&&r("")},[null===b||void 0===b?void 0:b.getTime()]),{stringValue:q,inputRef:x,clearValue:function clearValue(a){r(null),null===c||void 0===c?void 0:c({e:a,value:null})}}};
//# sourceMappingURL=helpers.js.map